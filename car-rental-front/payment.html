<!doctype html>
<html lang="en">

<head>
  <title>CarRental &mdash; Payment</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="fonts/icomoon/style.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/bootstrap-datepicker.css">
  <link rel="stylesheet" href="css/jquery.fancybox.min.css">
  <link rel="stylesheet" href="css/owl.carousel.min.css">
  <link rel="stylesheet" href="css/owl.theme.default.min.css">
  <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">
  <link rel="stylesheet" href="css/aos.css">

  <!-- MAIN CSS -->
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

  <div class="site-wrap" id="home-section">
    <header class="site-navbar site-navbar-target" role="banner">
      <div class="container">
        <div class="row align-items-center position-relative">
          <div class="col-3">
            <div class="site-logo">
              <a href="index.html"><strong>CarRental</strong></a>
            </div>
          </div>
          <div class="col-9 text-right">
            <span class="d-inline-block d-lg-none"><a href="#" class="site-menu-toggle js-menu-toggle py-5 "><span
                  class="icon-menu h3 text-black"></span></a></span>

            <nav class="site-navigation text-right ml-auto d-none d-lg-block" role="navigation">
              <ul class="site-menu main-menu js-clone-nav ml-auto ">
                <li class="active"><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="listing.html" class="nav-link">Listings</a></li>
                <li><a href="reviews.html" class="nav-link">Reviews</a></li>
                <li><a href="about.html" class="nav-link">About</a></li>
                <li><a href="contact.html" class="nav-link">Contact us</a></li>
                <li><a href="bookings.html" class="nav-link">Your booking</a></li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </header>

    <div class="hero inner-page" style="background-image: url('images/hero_1_a.jpg');">
      <div class="container">
        <div class="row align-items-end ">
          <div class="col-lg-5">
            <div class="intro">
              <h1><strong>Payment</strong></h1>
              <div class="custom-breadcrumbs"><a href="index.html">Home</a> <span class="mx-2">/</span> <strong>Payment</strong></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="site-section bg-light">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <img id="car-image" src="" alt="Car Image" class="img-fluid">
          </div>
          <div class="col-md-6">
            <h2 id="car-make-model"></h2>
            <ul id="car-specs">
              <li><p id="price-per-day"></p></li>
            </ul>
            <div id="payment-details">
              <h3> Your price breakdown: </h3>
              <p id="total-price"></p>
              <p id="tax"></p>
              <p id="service-fee"></p>
              <p id="final-total"></p>
            </div>
            <form id="payment-form">
              <div class="form-group">
                <button type="submit" id="pay-button" class="btn btn-primary">Pay Now</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <footer class="site-footer">
      <div class="container">
        <div class="row">
          <div class="col-lg-3">
            <h2 class="footer-heading mb-4">About Us</h2>
            <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p>
            <ul class="list-unstyled social">
              <li><a href="#"><span class="icon-facebook"></span></a></li>
              <li><a href="#"><span class="icon-instagram"></span></a></li>
              <li><a href="#"><span class="icon-twitter"></span></a></li>
              <li><a href="#"><span class="icon-linkedin"></span></a></li>
            </ul>
          </div>
          <div class="col-lg-8 ml-auto">
            <div class="row">
              <div class="col-lg-3">
                <h2 class="footer-heading mb-4">Quick Links</h2>
                <ul class="list-unstyled">
                  <li><a href="#">About Us</a></li>
                  <li><a href="#">Testimonials</a></li>
                  <li><a href="#">Terms of Service</a></li>
                  <li><a href="#">Privacy</a></li>
                  <li><a href="#">Contact Us</a></li>
                </ul>
              </div>
              <div class="col-lg-3">
                <h2 class="footer-heading mb-4">Resources</h2>
                <ul class="list-unstyled">
                  <li><a href="#">About Us</a></li>
                  <li><a href="#">Testimonials</a></li>
                  <li><a href="#">Terms of Service</a></li>
                  <li><a href="#">Privacy</a></li>
                  <li><a href="#">Contact Us</a></li>
                </ul>
              </div>
              <div class="col-lg-3">
                <h2 class="footer-heading mb-4">Support</h2>
                <ul class="list-unstyled">
                  <li><a href="#">About Us</a></li>
                  <li><a href="#">Testimonials</a></li>
                  <li><a href="#">Terms of Service</a></li>
                  <li><a href="#">Privacy</a></li>
                  <li><a href="#">Contact Us</a></li>
                </ul>
              </div>
              <div class="col-lg-3">
                <h2 class="footer-heading mb-4">Company</h2>
                <ul class="list-unstyled">
                  <li><a href="#">About Us</a></li>
                  <li><a href="#">Testimonials</a></li>
                  <li><a href="#">Terms of Service</a></li>
                  <li><a href="#">Privacy</a></li>
                  <li><a href="#">Contact Us</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="row pt-5 mt-5 text-center">
          <div class="col-md-12">
            <div class="border-top pt-5">
              <p>
                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This
                template is made with <i class="icon-heart text-danger" aria-hidden="true"></i> by <a
                  href="https://colorlib.com" target="_blank">Colorlib</a>
                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
              </p>
            </div>
          </div>
        </div>
      </div>
    </footer>

  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const carId = urlParams.get('car-id');
      const startDate = new Date(urlParams.get('start-date'));
      const endDate = new Date(urlParams.get('end-date'));
      const startTime = urlParams.get('start-time');
      const endTime = urlParams.get('end-time');
  
      if (carId) {
        fetch(`http://ec2-3-96-139-27.ca-central-1.compute.amazonaws.com:3000/cars/${carId}`)
          .then(response => response.json())
          .then(car => {
            // Set car image and details
            document.getElementById('car-image').src = `images/car_${car.id}.jpg`;
            document.getElementById('car-make-model').innerText = `${car.make} ${car.model}`;
            document.getElementById('price-per-day').innerText = `Price per day: $${car.price}`;
  
            // Calculate the total number of days
            let days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            if (endTime && (new Date(`${urlParams.get('end-date')} ${urlParams.get('end-time')}`) > new Date(`${urlParams.get('start-date')} ${urlParams.get('start-time')}`))) {
              days = Math.max(days, 1); // Ensure at least one day is charged
            }
  
            // Calculate costs
            const pricePerDay = car.price;
            const totalPrice = days * pricePerDay;
            const tax = totalPrice * 0.13;
            const serviceFee = totalPrice * 0.05;
            const finalTotal = totalPrice + tax + serviceFee;
  
            // Set calculated values
            document.getElementById('total-price').innerText = `Total price: $${car.price} x ${days} days = ${totalPrice.toFixed(2)}`;
            document.getElementById('tax').innerText = `Tax (13%): $${tax.toFixed(2)}`;
            document.getElementById('service-fee').innerText = `Service fee (5%): $${serviceFee.toFixed(2)}`;
            document.getElementById('final-total').innerText = `Grand total: $${finalTotal.toFixed(2)}`;
  
            // Handle form submission
            document.getElementById('payment-form').addEventListener('submit', (event) => {
              event.preventDefault(); // Prevent default form submission
              const formData = {
                'firstName': urlParams.get('first-name'),
                'lastName': urlParams.get('last-name'),
                'phoneNumber': urlParams.get('phone'),
                'email': urlParams.get('email'),
                'carId': carId,
                'startDate': urlParams.get('start-date'),
                'startTime': urlParams.get('start-time'),
                'endDate': urlParams.get('end-date'),
                'endTime': urlParams.get('end-time'),
                'totalPrice': totalPrice.toFixed(2),
                'tax': tax.toFixed(2),
                'serviceFee': serviceFee.toFixed(2),
                'finalTotal': finalTotal.toFixed(2),
              };
              console.log(formData);
              fetch('http://ec2-3-96-139-27.ca-central-1.compute.amazonaws.com:3000/book', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
              })
              .then(response => response.json())
              .then(data => {
                window.location.href = 'thankyou.html?car-id=' + carId + '&booking-id=' + data; // Redirect with query params
              })
              .catch(error => console.error('Error processing payment:', error));
            });
          })
          .catch(error => console.error('Error fetching car data:', error));
      }
    });
  </script>
  

</body>

</html>